<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PSI v3.2 | Resonance Engine</title>

<link rel="manifest" href="manifest.json">

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">

<style>
  :root {
    --bg-dark: #080808;
    --text-main: #e0e0e0;
    --accent: #00D4FF;
    --border: #333;
    --hit: #00FF00;
    --miss: #FF0055;
  }

  body {
    background-color: var(--bg-dark);
    color: var(--text-main);
    font-family: 'Rajdhani', sans-serif;
    margin: 0;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    user-select: none;
    padding: 20px;
  }

  /* Atmosphere */
  .bg-glow {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: radial-gradient(circle at 50% 70%, rgba(0, 212, 255, 0.05) 0%, #080808 80%);
    z-index: -1;
    pointer-events: none;
  }

  /* Header */
  .header { margin-bottom: 20px; }
  
  h1 {
    font-family: 'Cinzel', serif;
    font-weight: 400;
    font-size: 2.0rem;
    letter-spacing: 4px;
    margin: 0;
    color: #fff;
    text-shadow: 0 0 20px rgba(0, 212, 255, 0.3);
  }

  .subtitle {
    font-size: 0.85rem;
    color: var(--accent);
    letter-spacing: 3px;
    text-transform: uppercase;
    margin-top: 8px;
    opacity: 0.8;
  }

  /* Card Display */
  .card-container {
    margin-bottom: 30px;
    position: relative;
  }

  .card-stage {
    width: 220px;
    height: 320px;
    background: rgba(255,255,255,0.03);
    border: 1px solid var(--border);
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 5rem;
    color: #444;
    position: relative;
    box-shadow: 0 20px 50px rgba(0,0,0,0.5);
    transition: all 0.3s ease;
  }

  /* Active Card State */
  .card-stage.revealed {
    border-color: var(--accent);
    background: rgba(0, 212, 255, 0.05);
    color: #fff;
    box-shadow: 0 0 50px rgba(0, 212, 255, 0.2);
    transform: translateY(-5px);
  }

  /* Result Text */
  .result-message {
    margin-top: 15px;
    height: 20px;
    font-size: 0.9rem;
    letter-spacing: 1px;
    text-transform: uppercase;
    color: #888;
  }

  /* Controls */
  .controls {
    display: flex;
    gap: 15px;
    justify-content: center;
    flex-wrap: wrap;
    max-width: 600px;
    margin-bottom: 30px;
  }

  button.guess-btn {
    background: rgba(255,255,255,0.02);
    border: 1px solid var(--border);
    color: #888;
    padding: 0;
    width: 65px;
    height: 65px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 1.6rem;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    /* Remove tap highlight on mobile */
    -webkit-tap-highlight-color: transparent;
  }

  button.guess-btn:hover {
    border-color: var(--accent);
    color: #fff;
    background: rgba(0, 212, 255, 0.1);
    transform: scale(1.1);
  }
  
  button.guess-btn:active {
    transform: scale(0.95);
  }

  /* Stats Panel */
  .stats {
    display: flex;
    gap: 40px;
    font-size: 0.8rem;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 2px;
    border-top: 1px solid #222;
    padding-top: 20px;
  }

  .stat-block {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .stat-value {
    font-size: 1.8rem;
    color: #fff;
    font-family: 'Cinzel', serif;
    margin-top: 5px;
  }

  /* Return Button */
  .return-btn {
    margin-top: 50px;
    text-decoration: none;
    color: #555;
    font-size: 0.75rem;
    letter-spacing: 3px;
    border: 1px solid #333;
    padding: 12px 30px;
    border-radius: 50px;
    transition: 0.3s;
    text-transform: uppercase;
    background: transparent;
  }
  
  .return-btn:hover {
    color: #fff;
    border-color: var(--accent);
    background: rgba(0, 212, 255, 0.05);
  }
</style>
</head>
<body>

<div class="bg-glow"></div>

<div class="header">
  <h1>PSI v3.2</h1>
  <div class="subtitle">Zener Coincidence Engine</div>
</div>

<div class="card-container">
  <div class="card-stage" id="mainCard">?</div>
  <div class="result-message" id="feedback"></div>
</div>

<div class="controls">
  <button class="guess-btn" onclick="guess('CIRCLE')" title="Circle">○</button>
  <button class="guess-btn" onclick="guess('PLUS')" title="Plus">+</button>
  <button class="guess-btn" onclick="guess('WAVES')" title="Waves">≈</button>
  <button class="guess-btn" onclick="guess('SQUARE')" title="Square">□</button>
  <button class="guess-btn" onclick="guess('STAR')" title="Star">★</button>
</div>

<div class="stats">
  <div class="stat-block">
    HITS
    <span class="stat-value" id="hits" style="color:var(--accent)">0</span>
  </div>
  <div class="stat-block">
    MISSES
    <span class="stat-value" id="misses">0</span>
  </div>
  <div class="stat-block">
    TOTAL
    <span class="stat-value" id="total">0</span>
  </div>
</div>

<a href="https://skdietrich.github.io/The-American-Paranormal/" class="return-btn">
  Return to System Portal
</a>

<script>
  const AudioEngine = {
    ctx: null,
    
    init: function() {
      if (!this.ctx) {
        // Create audio context on first interaction
        this.ctx = new (window.AudioContext || window.webkitAudioContext)();
      }
    },

    playTone: function(freq, type, duration) {
      this.init();
      if (this.ctx.state === 'suspended') this.ctx.resume();

      const osc = this.ctx.createOscillator();
      const gain = this.ctx.createGain();

      osc.type = type;
      osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
      
      // Volume Envelope (Fade out)
      gain.gain.setValueAtTime(0.1, this.ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + duration);

      osc.connect(gain);
      gain.connect(this.ctx.destination);

      osc.start();
      osc.stop(this.ctx.currentTime + duration);
    },

    playHit: function() {
      // High pitched 'Sonar' ping (Sine wave)
      this.playTone(880, 'sine', 0.6); 
      // Add a slight harmonic
      setTimeout(() => this.playTone(1760, 'sine', 0.3), 50);
    },

    playMiss: function() {
      // Low pitched 'Thud' (Triangle wave)
      this.playTone(150, 'triangle', 0.4);
      // Pitch drop effect
      setTimeout(() => this.playTone(100, 'triangle', 0.3), 50);
    }
  };
</script>

<script>
  const symbols = ['CIRCLE', 'PLUS', 'WAVES', 'SQUARE', 'STAR'];
  const displayMap = {
    'CIRCLE': '○',
    'PLUS': '+',
    'WAVES': '≈',
    'SQUARE': '□',
    'STAR': '★'
  };
  
  let hits = 0;
  let misses = 0;
  let total = 0;
  let isProcessing = false;

  function guess(userChoice) {
    if (isProcessing) return; 
    isProcessing = true;

    // Initialize Audio Context on first click
    AudioEngine.init();

    const target = symbols[Math.floor(Math.random() * symbols.length)];
    const cardElement = document.getElementById('mainCard');
    const feedbackElement = document.getElementById('feedback');
    
    // REVEAL
    cardElement.innerHTML = displayMap[target];
    cardElement.classList.add('revealed');

    // LOGIC
    total++;
    if (userChoice === target) {
      hits++;
      // HIT VISUALS
      cardElement.style.borderColor = 'var(--hit)';
      cardElement.style.boxShadow = '0 0 60px rgba(0, 255, 0, 0.3)';
      cardElement.style.color = 'var(--hit)';
      feedbackElement.innerHTML = `<span style="color:var(--hit)">MATCH CONFIRMED</span>`;
      
      // HIT SOUND
      AudioEngine.playHit();
      
    } else {
      misses++;
      // MISS VISUALS
      cardElement.style.borderColor = 'var(--miss)';
      cardElement.style.boxShadow = '0 0 60px rgba(255, 0, 85, 0.3)';
      cardElement.style.color = '#fff'; 
      feedbackElement.innerHTML = `YOU CHOSE <span style="color:#888">${userChoice}</span> // TARGET WAS <span style="color:#fff">${target}</span>`;
      
      // MISS SOUND
      AudioEngine.playMiss();
    }

    // UPDATE STATS
    document.getElementById('hits').innerText = hits;
    document.getElementById('misses').innerText = misses;
    document.getElementById('total').innerText = total;

    // RESET
    setTimeout(() => {
      cardElement.classList.remove('revealed');
      cardElement.style.borderColor = ''; 
      cardElement.style.boxShadow = '';
      cardElement.style.color = '#444'; 
      cardElement.innerHTML = '?';
      feedbackElement.innerHTML = ''; 
      isProcessing = false;
    }, 1500);
  }

  // Service Worker for PWA
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('service-worker.js')
      .then(reg => console.log('Service Worker Registered'))
      .catch(err => console.log('Service Worker Error', err));
  }
</script>

</body>
</html>
